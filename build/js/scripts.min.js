function Video(title,videoUrl,order){this.title=title,this.videoUrl=videoUrl,this.order=order,this.setOrder=function(order){this.order=order},this.getInfo=function(){return title+", "+videoUrl}}function blurFunction(){console.log("blur function"),document.activeElement.blur(),0==$(".ddm:hover").length&&$(".ddm").hide()}function unBlurFunction(){console.log("focus function");var scope=angular.element($("#main")).scope();""!=scope.searchField&&null!=scope.searchField&&(console.log(scope.searchField),console.log("show"),$(".ddm").show())}function prettyLog(somethingToLog){console.log("--------------------------"),console.log(somethingToLog),console.log("--------------------------")}function removeBlankTitles(array){for(var indexOfBlank=-1,done=!1;!done;){for(var i=0;i<array.length;i++)(void 0===array[i].title||""===array[i].title)&&(indexOfBlank=i);indexOfBlank>-1?(array.splice(indexOfBlank,1),indexOfBlank=-1,done=!1):done=!0}return array}function limitArrayTo(array,limit){return array.splice(limit,array.length),array}function arrayToUpperCase(array){return array.forEach(function(element){element.title=element.title.toLowerCase()}),array}function onClientLoad(){gapi.client.load("youtube","v3",onYouTubeApiLoad)}function onYouTubeApiLoad(){gapi.client.setApiKey(tubifyKeys[0]),console.log("Google auth complete.")}function startPlayer(){var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)}function onYouTubeIframeAPIReady(){var scope=angular.element($("#main")).scope(),vid="M7lc1UVf-VE";scope.list1.length>0&&(vid=scope.list1[0].urlId),player=new YT.Player("player",{height:"390",width:"640",videoId:vid,events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})}function onPlayerReady(event){event.target.playVideo(),console.log("player ready")}function onPlayerStateChange(event){console.log(event);var scope=angular.element($("#main")).scope();event.data==done&&(0==scope.repeat?(scope.playlistIndex==scope.list1.length-1||null==scope.playlistIndex?scope.playlistIndex=0:scope.playlistIndex+=1,console.log(scope.indexList[scope.playlistIndex]),console.log(scope.playlistIndex),player.loadVideoById(scope.list1[scope.indexList[scope.playlistIndex]].urlId),scope.$apply()):player.seekTo(0))}function stopVideo(){player.stopVideo()}tubifyKeys=["AIzaSyCta-iZmjb-1_8b0ew5p41RWUEgL2sQAvk"];var app=angular.module("Tubify",[]);app.controller("LayoutController",function($scope){}),app.controller("ChatController",function($scope){var scope=angular.element($("#main")).scope();$scope.users=["user1","user2"],$scope.messages=[],$scope.name=localStorage.getItem("name"),console.log($scope.name+" 1"),console.log(username+" 2"),console.log("sup");var tempUser;if("guest"!=username&&(tempUser=username),$scope.name||"guest"!=username){var nameMessage={name:tempUser||$scope.name,room:scope.playlistField};scope.socket.emit("store name",nameMessage)}else $(".name-container").show(),$(".name-field").focus();$scope.changeName=function(){$(".name-container").hide(),localStorage.setItem("name",$scope.nameInput);var nameMessage={name:tempUser||$scope.nameInput,room:scope.playlistField};scope.socket.emit("store name",nameMessage)},$scope.getUsers=function(){},$scope.getMessages=function(){},$scope.saveMessage=function(){var messageObject={name:username||"guest",message:$scope.chatInput,playlist:scope.playlistField};$scope.chatInput="",scope.socket.emit("send message",messageObject)},scope.socket.on("userList",function(data){console.log("userList mesasge"),$scope.users=data,$scope.$apply()}),scope.socket.on("message",function(data){console.log("received chat message"),$scope.messages.push(data),$scope.$apply(),$(".chat-messages").scrollTop($(".chat-messages")[0].scrollHeight)}),scope.socket.on("messages",function(data){console.log("received chat message"),$scope.messages=[],$scope.messages.push.apply($scope.messages,data.messages),$scope.users=data.users,$scope.$apply(),$(".chat-messages").scrollTop($(".chat-messages")[0].scrollHeight)})});var latestSearchResponse,socketRoom="",socketMessages={playlistChange:"change order successful",syncedUser:"Sync"};app.controller("CoreController",function($scope){$scope.searchList=["..."],$scope.playlistCounter=0,$scope.enterPlaylistList=function(index){index!=$scope.indexList[$scope.playlistIndex]&&($scope.playlistCounter=index)},$scope.leavePlaylistList=function(index){$scope.playlistCounter=null},$scope.socket=io(),$scope.sync=!1,$scope.socket.on("sync play video",function(data){console.log("playing video index "+data.index),$scope.playlistIndex=$scope.indexList.indexOf(data.index),player.loadVideoById($scope.list1[data.index].urlId),$scope.$apply()}),$scope.socket.on("receiveSync",function(username){console.log("User: "+username+" has joined.")}),$scope.socket.on("change order successful",function(msg){console.log("changing order zzzzzzzzzzzzzzzzzzzzzz"),$scope.playlistIndex=msg.indexList[$scope.playlistIndex],$scope.playlistChange(),$scope.$apply()}),$scope.socket.on("delete successful",function(msg){console.log("deleting video"),$scope.playlistChange(),$scope.$apply()}),$scope.socket.on("addVid",function(msg){console.log("received addedvid message"),console.log(msg.title+msg.urlId);var obj={title:msg.title,urlId:msg.urlId,thumb:msg.thumb,searchString:msg.searchString};$scope.list1.push(obj),$scope.indexList=[];for(var i=0;i<$scope.list1.length;i++)$scope.indexList.push(i);$scope.$apply()}),$scope.socket.on("playlist",function(msg){console.log("playlist"),"undefined"!=typeof msg.indexList&&($scope.playlistIndex=msg.indexList.indexOf($scope.playlistIndex)),"undefined"!=typeof msg.index&&(msg.index<$scope.playlistIndex?$scope.playlistIndex--:msg.index==$scope.playlistIndex&&($scope.playlistIndex=null)),$scope.list1=[],$scope.indexList=[];for(var i=0;i<msg.list.length;i++)$scope.indexList.push(i),$scope.list1.push(msg.list[msg.order[i]]);window.history.pushState("object or string","Title","/p/"+$scope.playlistField),$scope.$apply()}),$scope.socket.on("playlist first",function(msg){$scope.list1=[],$scope.indexList=[];for(var i=0;i<msg.list.length;i++)$scope.indexList.push(i),$scope.list1.push(msg.list[msg.order[i]]);startPlayer(),$scope.$apply()}),$scope.repeat=!1;var realCounter=($scope.searchField,0);$scope.list1=[],$scope.searchList=[],$scope.counter=0,$scope.playlistIndex=0,$scope.indexList=[];var playlistFromStorage=localStorage.getItem("playlist");""!=pl?($scope.playlistField=pl,$scope.socket.emit("join first",$scope.playlistField)):null!=playlistFromStorage?($scope.playlistField=playlistFromStorage,$scope.socket.emit("join first",$scope.playlistField)):startPlayer(),$scope.toggleRepeat=function(){$scope.repeat=!$scope.repeat},$scope.search=function(){realCounter=0,$scope.counter=0,$scope.searchList=[];var query=$scope.searchField,request=gapi.client.youtube.search.list({q:query,part:"snippet",type:"video",maxResults:"15"});""!=$scope.searchField&&null!=$scope.searchField?(console.log("showing"),$(".ddm").show(),request.execute(function(response){latestSearchResponse=response,$scope.searchList=[];for(var i=0;i<Math.min(response.items.length,3);i++){var obj={title:response.items[i].snippet.title,thumb:response.items[i].snippet.thumbnails.medium.url,videoId:response.items[i].id.videoId};$scope.searchList.push(obj)}$scope.$apply()})):""==$scope.searchField&&$(".ddm").hide()},$scope.displayKey=function($event){var realLength=latestSearchResponse.items.length;if(38==$event.keyCode)if($event.preventDefault(),$scope.counter>0)$scope.counter--,realCounter--;else if($scope.counter=0,realCounter>0){realCounter--;var obj={title:latestSearchResponse.items[realCounter].snippet.title,thumb:latestSearchResponse.items[realCounter].snippet.thumbnails.medium.url,videoId:latestSearchResponse.items[realCounter].id.videoId};$scope.searchList.pop(),$scope.searchList.unshift(obj)}if(40==$event.keyCode)if($event.preventDefault(),$scope.counter<Math.min(2,realLength-1))$scope.counter++,realCounter++;else if($scope.counter=Math.min(2,realLength-1),realLength-1>realCounter){realCounter++;var obj={title:latestSearchResponse.items[realCounter].snippet.title,thumb:latestSearchResponse.items[realCounter].snippet.thumbnails.medium.url,videoId:latestSearchResponse.items[realCounter].id.videoId};$scope.searchList.shift(),$scope.searchList.push(obj)}27==$event.keyCode&&document.activeElement.blur(),13==$event.keyCode&&$scope.playVideo()},$scope.addVideo=function(){({title:$scope.searchList[$scope.counter].title,urlId:$scope.searchList[$scope.counter].videoId,thumb:$scope.searchList[$scope.counter].thumb,searchField:$scope.searchField,room:$scope.playlistField})},$scope.playVideo=function(){console.log("play video");var data={title:$scope.searchList[$scope.counter].title,urlId:$scope.searchList[$scope.counter].videoId,thumb:$scope.searchList[$scope.counter].thumb,searchField:$scope.searchField,room:$scope.playlistField};console.log("emitted addedvid"),$scope.socket.emit("addedVid",data),$scope.searchField="",$scope.searchList=[]},$scope.sync2=function(){$scope.sync=!$scope.sync;var data={username:username,playlist:$scope.playlistField,syncing:$scope.sync};$scope.socket.emit("sync",data)},$scope.onScroll=function($event){var realLength=latestSearchResponse.items.length;if(event.wheelDelta>0){if(console.log("scrolled up"),realCounter-$scope.counter>0){realCounter--;var obj={title:latestSearchResponse.items[realCounter+(0-$scope.counter)].snippet.title,thumb:latestSearchResponse.items[realCounter+(0-$scope.counter)].snippet.thumbnails.medium.url,videoId:latestSearchResponse.items[realCounter+(0-$scope.counter)].id.videoId};$scope.searchList.pop(),$scope.searchList.unshift(obj)}}else if(console.log("scrolled down"),realCounter-$scope.counter+2<realLength-1){realCounter++;var obj={title:latestSearchResponse.items[realCounter+(2-$scope.counter)].snippet.title,thumb:latestSearchResponse.items[realCounter+(2-$scope.counter)].snippet.thumbnails.medium.url,videoId:latestSearchResponse.items[realCounter+(2-$scope.counter)].id.videoId};$scope.searchList.shift(),$scope.searchList.push(obj)}},$scope.enterSearchList=function(index){console.log(index),realCounter=realCounter+index-$scope.counter,$scope.counter=index},$scope.playClickedVideo=function(index){console.log(index),$scope.playlistIndex=$scope.indexList.indexOf(index),player.loadVideoById($scope.list1[index].urlId);var data={playlist:$scope.playlistField,index:$scope.playlistIndex};$scope.sync&&$scope.socket.emit("sync play video",data)},$scope.playlistChange=function(){$scope.sync&&($scope.sync=!1),$scope.socket.emit("join",$scope.playlistField),localStorage.setItem("playlist",$scope.playlistField)},$scope.deleteVideo=function(index){var data={playlist:$scope.playlistField,list:$scope.indexList,index:index};$scope.socket.emit("delete video",data)}}),$(document).on("keydown keyup",".searchBox",function(event){(38==event.which||40==event.which)&&event.preventDefault()}),$(document).on("keyup",function(event){13==event.keyCode&&($(".chat-field").is(":focus")||document.activeElement.blur())}),app.directive("ngScroll",function(){return function(scope,element,attrs){element.bind("mousewheel",function(event){event&&scope.$apply(function(){scope.$eval(attrs.ngScroll)})})}}),$(function(){$(".ddm").dropdown("toggle"),$(".ddm").hide(),$("#search").click(function(e){console.log("Clicked 1"),e.preventDefault(),(null==$("#search").val()||""==$("#search").val())&&(console.log("NULL 2"),$(".ddm").hide())});var a,scope=angular.element($("#main")).scope();$("#sortable").sortable({update:function(event,ui){if(console.log(scope.indexList),console.log("update: "+ui.item.index()),console.log("update from: "+a),a<ui.item.index()){for(var temp=scope.indexList[a],i=a;i<=ui.item.index()-1;i++)scope.indexList[i]=scope.indexList[i+1];scope.indexList[ui.item.index()]=temp}else if(a>ui.item.index()){for(var temp=scope.indexList[a],i=a;i>=ui.item.index()+1;i--)scope.indexList[i]=scope.indexList[i-1];scope.indexList[ui.item.index()]=temp}console.log(scope.indexList);var data={playlist:scope.playlistField,indexList:scope.indexList};scope.socket.emit("changeOrder",data)},start:function(event,ui){a=ui.item.index(),console.log("start: "+ui.item.index())}}),$("#sortable").disableSelection(),console.log("sortable")}),$(document).on("keyup",function(event){0==$("*:focus").length&&((80==event.keyCode||49==event.keyCode)&&(console.log("p key"),document.getElementById("playlistField").focus(),document.getElementById("playlistField").select()),(83==event.keyCode||50==event.keyCode)&&(document.getElementById("search").focus(),document.getElementById("search").select())),27==event.keyCode&&document.activeElement.blur()}),app.controller("FeaturedPlaylistController",function($scope,$http){$scope.featuredPlaylists=[];const limit=10;$http.get("/p",{}).then(function(response){$scope.featuredPlaylists=response.data,$scope.featuredPlaylists=removeBlankTitles($scope.featuredPlaylists),$scope.featuredPlaylists=limitArrayTo($scope.featuredPlaylists,limit),$scope.featuredPlaylists=arrayToUpperCase($scope.featuredPlaylists)},function(err){$scope.featuredPlaylists.push("Error fetching the featured playlist.")}),$scope.loadPlaylist=function(index){var scope=angular.element($("#main")).scope();scope.playlistField=$scope.featuredPlaylists[index].title,scope.playlistChange()}}),app.controller("RegisterController",function($scope){$scope.register=function(){$scope.emailField,$scope.usernameField,$scope.passwordField}});var player,done=!1;